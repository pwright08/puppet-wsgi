#!/usr/bin/env bash
# Startup script for Land Registry's <%= @name %> Java application

# Port the application should listen on
export PORT=<%= @bind %>

# Load environment variables
echo 'Loading environment variables...'
source <%= @cfg_file  %>

# Ensure Java is configured correctly
export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk/
cd <%= @code_dir %>

# Logging configuration
ERROR_LOG='<%= @error_log %>'
APPLICATION_LOG='<%= @application_log %>'

# Run time
echo "Starting web service on ${PORT}..."
nohup java -jar <%= @jar_name  %> <%= @extra_args %> > >(tee -a ${APPLICATION_LOG}) 2> >(tee -a ${ERROR_LOG} >&2) &
echo $! > ../<%= @service %>.pid
